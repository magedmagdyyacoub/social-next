{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Barakat/Desktop/social-next/lib/prisma.js"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = globalThis;\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient();\r\n\r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\r\n\r\nexport default prisma;\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY;AAElB,wCAA2C,gBAAgB,MAAM,GAAG;uCAErD"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Barakat/Desktop/social-next/lib/auth.js"],"sourcesContent":["import { cookies } from \"next/headers\";\r\nimport prisma from \"./prisma\";\r\n\r\n// هذه الدالة ترجع بيانات المستخدم من الـ cookie\r\nexport async function getUserFromCookie() {\r\n  const cookieStore = await cookies();\r\n  const token = cookieStore.get(\"token\")?.value;\r\n\r\n  if (!token) return null;\r\n\r\n  const user = await prisma.user.findUnique({\r\n    where: { id: token },\r\n  });\r\n\r\n  return user;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,UAAU;IAExC,IAAI,CAAC,OAAO,OAAO;IAEnB,MAAM,OAAO,MAAM,0HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE,IAAI;QAAM;IACrB;IAEA,OAAO;AACT"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Barakat/Desktop/social-next/app/api/posts/create/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport prisma from \"@/lib/prisma\";\r\nimport { getUserFromCookie } from \"@/lib/auth\";\r\nimport formidable from \"formidable\";\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\n\r\n// Disable Next.js body parsing (so formidable can handle it)\r\nexport const config = {\r\n  api: {\r\n    bodyParser: false,\r\n  },\r\n};\r\n\r\n// Ensure uploads folder exists\r\nconst uploadDir = path.join(process.cwd(), \"/public/uploads\");\r\nif (!fs.existsSync(uploadDir)) fs.mkdirSync(uploadDir, { recursive: true });\r\n\r\nexport async function POST(req) {\r\n  const user = await getUserFromCookie(req);\r\n  if (!user) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n\r\n  const form = formidable({\r\n    uploadDir,\r\n    keepExtensions: true,\r\n    maxFileSize: 50 * 1024 * 1024, // 50 MB\r\n    multiples: true,\r\n  });\r\n\r\n  return new Promise((resolve, reject) => {\r\n    form.parse(req, async (err, fields, files) => {\r\n      if (err) return resolve(NextResponse.json({ error: err.message }, { status: 500 }));\r\n\r\n      const { title, content } = fields;\r\n\r\n      let imageUrl = null;\r\n      let videoUrl = null;\r\n\r\n      if (files.image) {\r\n        const file = Array.isArray(files.image) ? files.image[0] : files.image;\r\n        imageUrl = `/uploads/${path.basename(file.filepath)}`;\r\n      }\r\n\r\n      if (files.video) {\r\n        const file = Array.isArray(files.video) ? files.video[0] : files.video;\r\n        videoUrl = `/uploads/${path.basename(file.filepath)}`;\r\n      }\r\n\r\n      try {\r\n        const post = await prisma.post.create({\r\n          data: {\r\n            title,\r\n            content,\r\n            image: imageUrl,\r\n            video: videoUrl,\r\n            authorId: user.id,\r\n          },\r\n        });\r\n\r\n        resolve(NextResponse.json({ post }));\r\n      } catch (e) {\r\n        resolve(NextResponse.json({ error: e.message }, { status: 500 }));\r\n      }\r\n    });\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAGO,MAAM,SAAS;IACpB,KAAK;QACH,YAAY;IACd;AACF;AAEA,+BAA+B;AAC/B,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAC3C,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,YAAY,wGAAE,CAAC,SAAS,CAAC,WAAW;IAAE,WAAW;AAAK;AAElE,eAAe,KAAK,GAAG;IAC5B,MAAM,OAAO,MAAM,IAAA,kIAAiB,EAAC;IACrC,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;IAE7E,MAAM,OAAO,IAAA,uKAAU,EAAC;QACtB;QACA,gBAAgB;QAChB,aAAa,KAAK,OAAO;QACzB,WAAW;IACb;IAEA,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,KAAK,KAAK,CAAC,KAAK,OAAO,KAAK,QAAQ;YAClC,IAAI,KAAK,OAAO,QAAQ,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,IAAI,OAAO;YAAC,GAAG;gBAAE,QAAQ;YAAI;YAEhF,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG;YAE3B,IAAI,WAAW;YACf,IAAI,WAAW;YAEf,IAAI,MAAM,KAAK,EAAE;gBACf,MAAM,OAAO,MAAM,OAAO,CAAC,MAAM,KAAK,IAAI,MAAM,KAAK,CAAC,EAAE,GAAG,MAAM,KAAK;gBACtE,WAAW,CAAC,SAAS,EAAE,4GAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,GAAG;YACvD;YAEA,IAAI,MAAM,KAAK,EAAE;gBACf,MAAM,OAAO,MAAM,OAAO,CAAC,MAAM,KAAK,IAAI,MAAM,KAAK,CAAC,EAAE,GAAG,MAAM,KAAK;gBACtE,WAAW,CAAC,SAAS,EAAE,4GAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,GAAG;YACvD;YAEA,IAAI;gBACF,MAAM,OAAO,MAAM,0HAAM,CAAC,IAAI,CAAC,MAAM,CAAC;oBACpC,MAAM;wBACJ;wBACA;wBACA,OAAO;wBACP,OAAO;wBACP,UAAU,KAAK,EAAE;oBACnB;gBACF;gBAEA,QAAQ,gJAAY,CAAC,IAAI,CAAC;oBAAE;gBAAK;YACnC,EAAE,OAAO,GAAG;gBACV,QAAQ,gJAAY,CAAC,IAAI,CAAC;oBAAE,OAAO,EAAE,OAAO;gBAAC,GAAG;oBAAE,QAAQ;gBAAI;YAChE;QACF;IACF;AACF"}}]
}